"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var Rx_1 = require("rxjs/Rx");
require("nativescript-websockets");
var Message = (function () {
    function Message(author, text) {
        this.text = text;
        this.author = author;
    }
    return Message;
}());
exports.Message = Message;
var Connection = (function () {
    function Connection(host) {
        this.host = host;
    }
    Connection.prototype.initEventsMapping = function () {
        var _this = this;
        this.rsub = this.receiver.map(function (event) {
            return JSON.parse(event);
        }).subscribe(function (value) {
            var type = value.type;
            if (_this.eventMap[type]) {
                return _this.eventMap[type].next(value.data);
            }
        });
    };
    Connection.prototype.establishConnection = function (id, rooms) {
        var _this = this;
        return new Rx_1.Observable(function (subscriber) {
            _this.eventMap = {};
            _this.id = id;
            _this.receiver = new Rx_1.Subject();
            _this.socket =
                new WebSocket("ws://" + _this.host + "/ws/join/?id=" + id + (rooms.length ?
                    "?rooms=" + rooms.join(',') : ""), []);
            _this.socket.onopen = function (event) {
                console.log("Handshake success.");
                subscriber.next({
                    success: true,
                    rooms: rooms
                });
                _this.initEventsMapping();
            };
            _this.socket.onerror = function (event) {
                console.log("Handshake failed.");
                subscriber.error(event);
            };
            _this.socket.onmessage = function (message) {
                console.log(JSON.stringify(message.data));
                _this.receiver.next(message.data);
            };
        });
    };
    Connection.prototype.subscribeTo = function (event) {
        if (this.eventMap[event]) {
            return this.eventMap[event];
        }
        else {
            this.eventMap[event] = new Rx_1.Subject();
            return this.eventMap[event];
        }
    };
    Connection.prototype.send = function (data) {
        this.socket.send(JSON.stringify(data));
    };
    Connection.prototype.closeConnection = function () {
        var _this = this;
        if (!this.socket || !this.socket.CLOSED) {
            throw new Error("Connection is already closed");
        }
        return new Rx_1.Observable(function (subscriber) {
            _this.socket.onclose = function () {
                subscriber.next({ closed: true });
            };
            _this.rsub.unsubscribe();
            _this.socket.close();
        });
    };
    return Connection;
}());
var ChatroomService = (function () {
    function ChatroomService() {
        this.messages = [];
        this.connection = new Connection("172.18.0.1:8080");
    }
    ChatroomService.prototype.connect = function (id, rooms) {
        return this.connection.establishConnection(id, rooms);
    };
    ChatroomService.prototype.requestMessages = function (data, room) {
        this.connection.send(Object.assign({}, data, { room: room }));
    };
    ChatroomService.prototype.getMessages = function (room) {
        this.requestMessages({ type: "get" }, room);
        return this.on('get', room);
    };
    ChatroomService.prototype.on = function (event, roomname) {
        return this.connection.subscribeTo(event);
    };
    ChatroomService.prototype.disconnect = function () {
        return this.connection.closeConnection();
    };
    return ChatroomService;
}());
ChatroomService = __decorate([
    core_1.Injectable(),
    __metadata("design:paramtypes", [])
], ChatroomService);
exports.ChatroomService = ChatroomService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhdHJvb20uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNoYXRyb29tLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBbUQ7QUFDbkQsOEJBQTREO0FBQzVELE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0FBRW5DO0lBR0ksaUJBQVksTUFBYyxFQUFFLElBQVk7UUFDcEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUE7UUFDaEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUE7SUFDeEIsQ0FBQztJQUNMLGNBQUM7QUFBRCxDQUFDLEFBUEQsSUFPQztBQVBZLDBCQUFPO0FBYXBCO0lBUUksb0JBQVksSUFBSTtRQUNaLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFBO0lBQ3BCLENBQUM7SUFFTyxzQ0FBaUIsR0FBekI7UUFBQSxpQkFTQztRQVJHLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBQSxLQUFLO1lBQy9CLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQzVCLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxVQUFBLEtBQUs7WUFDZCxJQUFNLElBQUksR0FBVyxLQUFLLENBQUMsSUFBSSxDQUFBO1lBQy9CLEVBQUUsQ0FBQSxDQUFDLEtBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixNQUFNLENBQUMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO1lBQy9DLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCx3Q0FBbUIsR0FBbkIsVUFBb0IsRUFBUyxFQUFFLEtBQWU7UUFBOUMsaUJBeUJDO1FBeEJHLE1BQU0sQ0FBQyxJQUFJLGVBQVUsQ0FB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QGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzL1J4JztcbnJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtd2Vic29ja2V0c1wiKTtcblxuZXhwb3J0IGNsYXNzIE1lc3NhZ2Uge1xuICAgIHRleHQ6IHN0cmluZ1xuICAgIGF1dGhvcjogc3RyaW5nXG4gICAgY29uc3RydWN0b3IoYXV0aG9yOiBzdHJpbmcsIHRleHQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnRleHQgPSB0ZXh0XG4gICAgICAgIHRoaXMuYXV0aG9yID0gYXV0aG9yXG4gICAgfVxufVxuXG5pbnRlcmZhY2UgRXZlbnRNYXAge1xuICAgIFtzOiBzdHJpbmddOlN1YmplY3Q8YW55PlxufVxuXG5jbGFzcyBDb25uZWN0aW9uIHtcbiAgICBpZDogc3RyaW5nO1xuICAgIGhvc3Q6IHN0cmluZztcbiAgICBwcml2YXRlIHJlY2VpdmVyOiBTdWJqZWN0PGFueT47XG4gICAgcHJpdmF0ZSBzb2NrZXQ6IFdlYlNvY2tldDtcbiAgICBwcml2YXRlIGV2ZW50TWFwOkV2ZW50TWFwO1xuICAgIHByaXZhdGUgcnN1YjpTdWJzY3JpcHRpb247XG5cbiAgICBjb25zdHJ1Y3Rvcihob3N0KSB7XG4gICAgICAgIHRoaXMuaG9zdCA9IGhvc3RcbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXRFdmVudHNNYXBwaW5nKCkge1xuICAgICAgICB0aGlzLnJzdWIgPSB0aGlzLnJlY2VpdmVyLm1hcChldmVudCA9PiB7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShldmVudClcbiAgICAgICAgfSkuc3Vic2NyaWJlKHZhbHVlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSA8c3RyaW5nPnZhbHVlLnR5cGVcbiAgICAgICAgICAgIGlmKHRoaXMuZXZlbnRNYXBbdHlwZV0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ldmVudE1hcFt0eXBlXS5uZXh0KHZhbHVlLmRhdGEpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgZXN0YWJsaXNoQ29ubmVjdGlvbihpZDpzdHJpbmcsIHJvb21zOiBzdHJpbmdbXSk6T2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKHN1YnNjcmliZXIgPT4ge1xuICAgICAgICAgICAgdGhpcy5ldmVudE1hcCA9IHt9O1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5yZWNlaXZlciA9IG5ldyBTdWJqZWN0KCk7XG4gICAgICAgICAgICB0aGlzLnNvY2tldCA9IFxuICAgICAgICAgICAgICAgIG5ldyBXZWJTb2NrZXQoYHdzOi8vJHt0aGlzLmhvc3R9L3dzL2pvaW4vP2lkPSR7aWR9JHtyb29tcy5sZW5ndGggP1xuICAgICAgICAgICAgICAgICAgICBcIj9yb29tcz1cIiArIHJvb21zLmpvaW4oJywnKSA6IFwiXCJ9YCwgW10pO1xuICAgICAgICAgICAgdGhpcy5zb2NrZXQub25vcGVuID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJIYW5kc2hha2Ugc3VjY2Vzcy5cIilcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLm5leHQoe1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICByb29tczogcm9vbXNcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHRoaXMuaW5pdEV2ZW50c01hcHBpbmcoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zb2NrZXQub25lcnJvciA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSGFuZHNoYWtlIGZhaWxlZC5cIilcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLmVycm9yKGV2ZW50KVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zb2NrZXQub25tZXNzYWdlID0gKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShtZXNzYWdlLmRhdGEpKVxuICAgICAgICAgICAgICAgIHRoaXMucmVjZWl2ZXIubmV4dChtZXNzYWdlLmRhdGEpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgc3Vic2NyaWJlVG8oZXZlbnQ6IHN0cmluZyk6U3ViamVjdDxhbnk+IHtcbiAgICAgICAgaWYgKHRoaXMuZXZlbnRNYXBbZXZlbnRdKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ldmVudE1hcFtldmVudF1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRNYXBbZXZlbnRdID0gbmV3IFN1YmplY3QoKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnRNYXBbZXZlbnRdXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZW5kKGRhdGE6IGFueSk6dm9pZCB7XG4gICAgICAgIHRoaXMuc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpXG4gICAgfVxuXG4gICAgY2xvc2VDb25uZWN0aW9uKCk6T2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgaWYgKCF0aGlzLnNvY2tldCB8fCAhdGhpcy5zb2NrZXQuQ0xPU0VEKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb25uZWN0aW9uIGlzIGFscmVhZHkgY2xvc2VkXCIpXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShzdWJzY3JpYmVyID0+IHtcbiAgICAgICAgICAgIHRoaXMuc29ja2V0Lm9uY2xvc2UgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgc3Vic2NyaWJlci5uZXh0KHtjbG9zZWQ6dHJ1ZX0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnJzdWIudW5zdWJzY3JpYmUoKVxuICAgICAgICAgICAgdGhpcy5zb2NrZXQuY2xvc2UoKVxuICAgICAgICB9KVxuICAgIH1cbn1cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIENoYXRyb29tU2VydmljZSB7XG4gICAgbWVzc2FnZXM6IGFueVtdXG4gICAgcm9vbXM6IHN0cmluZ1tdXG4gICAgcHJpdmF0ZSBjb25uZWN0aW9uOiBDb25uZWN0aW9uXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMubWVzc2FnZXMgPSBbXVxuICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBuZXcgQ29ubmVjdGlvbihcIjE3Mi4xOC4wLjE6ODA4MFwiKVxuICAgIH1cblxuICAgIGNvbm5lY3QoaWQ6IHN0cmluZywgcm9vbXM6IHN0cmluZ1tdKTpPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0aW9uLmVzdGFibGlzaENvbm5lY3Rpb24oaWQsIHJvb21zKVxuICAgIH1cblxuICAgIHJlcXVlc3RNZXNzYWdlcyhkYXRhOiBhbnksIHJvb206IHN0cmluZyk6dm9pZCB7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbi5zZW5kKE9iamVjdC5hc3NpZ24oe30sIGRhdGEsIHtyb29tfSkpXG4gICAgfVxuXG4gICAgZ2V0TWVzc2FnZXMocm9vbTogc3RyaW5nKTpPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICB0aGlzLnJlcXVlc3RNZXNzYWdlcyh7dHlwZTogXCJnZXRcIn0sIHJvb20pXG4gICAgICAgIHJldHVybiB0aGlzLm9uKCdnZXQnLCByb29tKVxuICAgIH1cblxuICAgIG9uKGV2ZW50OiBzdHJpbmcsIHJvb21uYW1lOiBzdHJpbmcpOlN1YmplY3Q8YW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb24uc3Vic2NyaWJlVG8oZXZlbnQpXG4gICAgfVxuXG4gICAgZGlzY29ubmVjdCgpOk9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb24uY2xvc2VDb25uZWN0aW9uKClcbiAgICB9XG59XG4iXX0=